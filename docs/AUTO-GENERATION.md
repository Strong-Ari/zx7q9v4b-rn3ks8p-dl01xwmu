# Génération Automatique de Commentaires TikTok

## 🚀 Fonctionnalité

Le système génère maintenant automatiquement un nouveau commentaire TikTok à chaque fois que :

- Vous lancez le serveur de développement (`npm run dev`)
- Vous rafraîchissez la page dans le navigateur

## 📋 Comment ça marche

### 1. **Au démarrage du serveur**

```bash
npm run dev
```

Le script `predev` se lance automatiquement avant le serveur Next.js :

- Exécute `scripts/generate-comment-startup.ts`
- Génère un commentaire TikTok avec nom fixe : `tiktok-comment-current.png`
- Supprime l'ancienne image automatiquement

### 2. **Au chargement/rafraîchissement de la page**

Le hook `useAutoGeneratedComment` :

- Se déclenche automatiquement au montage du composant
- Appelle l'API `/api/generate-tiktok-comment`
- Met à jour l'image en temps réel
- Affiche le statut de génération dans l'UI

## 🎛️ Interface utilisateur

### Indicateur de statut

La page affiche maintenant :

- **🔄 Génération en cours** : Spinner animé + message
- **✅ Succès** : Pseudo et commentaire générés
- **❌ Erreur** : Message d'erreur détaillé
- **🔄 Bouton "Régénérer"** : Pour générer un nouveau commentaire manuellement

### Informations affichées

- Pseudo généré (ex: `lil.princess`)
- Commentaire généré (ex: `"would u tell ur crush u dreamt abt them ?"`)
- Statut de la génération en temps réel

## 🔧 Fichiers modifiés

### 1. **Hook personnalisé** : `src/hooks/useAutoGeneratedComment.ts`

- Gestion de l'état de génération
- Appel automatique au montage
- Interface pour régénération manuelle

### 2. **Page principale** : `src/app/page.tsx`

- Intégration du hook
- UI de statut de génération
- Bouton de régénération

### 3. **Composition vidéo** : `src/remotion/BallEscape.tsx`

- Cache-busting pour forcer le rechargement de l'image
- Timestamp ajouté à l'URL de l'image

### 4. **Scripts** :

- `scripts/generate-comment-startup.ts` : Génération au démarrage
- `package.json` : Script `predev` ajouté

## 🎯 Avantages

### ✅ **Expérience utilisateur fluide**

- Pas besoin de commandes manuelles
- Commentaire toujours frais au démarrage
- Régénération à la demande

### ✅ **Développement optimisé**

- Génération automatique au `npm run dev`
- Feedback visuel en temps réel
- Gestion d'erreurs intégrée

### ✅ **Système robuste**

- Retry automatique en cas d'échec
- Fallback sur l'ancienne image en cas d'erreur
- Cache-busting pour éviter les images obsolètes

## 🛠️ Commandes disponibles

### Génération manuelle

```bash
# Génération complète avec logs détaillés
npm run generate:comment

# Génération rapide (utilisée au démarrage)
npm run generate:startup
```

### Développement

```bash
# Lance le serveur + génère un commentaire automatiquement
npm run dev

# Juste le serveur (sans génération préalable)
npx next dev
```

## 🔍 Troubleshooting

### La génération ne se lance pas au démarrage

- Vérifiez que Playwright est installé : `npx playwright install chromium`
- Vérifiez la connexion internet

### L'image ne se met pas à jour dans la vidéo

- Le cache-busting devrait résoudre ce problème automatiquement
- En cas de problème, rechargez la page complètement (Ctrl+F5)

### Erreur de génération

- Cliquez sur "Régénérer" dans l'interface
- Vérifiez les logs de la console du navigateur
- Vérifiez que l'API `/api/generate-tiktok-comment` fonctionne

## 🎬 Workflow recommandé

1. **Démarrer le développement** :

   ```bash
   npm run dev
   ```

   ↳ Un commentaire est automatiquement généré

2. **Ouvrir le navigateur** :

   - Aller sur `http://localhost:3000`
   - Un nouveau commentaire se génère automatiquement
   - Observer le statut dans l'interface

3. **Régénérer si nécessaire** :

   - Cliquer sur "Régénérer" dans l'interface
   - Ou rafraîchir la page (F5)

4. **Exporter la vidéo** :
   ```bash
   npm run render
   ```
   ↳ La vidéo utilise automatiquement le dernier commentaire généré

## 💡 Conseils

- **Développement** : Le commentaire change à chaque rafraîchissement, parfait pour tester différents styles
- **Production** : Générez un commentaire final avec `npm run generate:comment` avant le rendu final
- **Personnalisation** : Modifiez les listes de pseudos/commentaires dans `tiktok-comment-generator.ts`
